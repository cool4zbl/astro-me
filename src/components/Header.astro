---
import ThemeToggle from './ThemeToggle.astro';
import { getLangFromUrl, getTranslations, getLocalizedPath } from '../i18n/config';

const lang = getLangFromUrl(Astro.url);
const t = getTranslations(lang);

const currentPath = Astro.url.pathname;
const basePath = lang === 'en' ? currentPath : currentPath.replace(`/${lang}`, '');
---

<header class="sticky top-0 z-40 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
  <div class="container mx-auto flex h-14 items-center justify-between px-4">
    <div class="flex items-center space-x-2">
      <a href={getLocalizedPath('/', lang)} class="flex items-center space-x-2">
        <span class="text-xl font-bold">{lang === 'zh' ? '我的博客' : 'My Blog'}</span>
      </a>
    </div>
    
    <nav class="flex items-center space-x-6">
      <a href={getLocalizedPath('/', lang)} class="text-sm font-medium transition-colors hover:text-primary">
        {t('nav.home')}
      </a>
      <a href={getLocalizedPath('/blog', lang)} class="text-sm font-medium transition-colors hover:text-primary">
        {t('nav.blog')}
      </a>
      <a href={getLocalizedPath('/tags', lang)} class="text-sm font-medium transition-colors hover:text-primary">
        {t('nav.tags')}
      </a>
      <a href={getLocalizedPath('/search', lang)} class="text-sm font-medium transition-colors hover:text-primary">
        {t('nav.search')}
      </a>
      <div class="flex items-center space-x-2">
        <!-- 修复语言切换链接 -->
        <a href={basePath === '/' ? '/zh' : `/zh${basePath}`} class={`text-xs px-2 py-1 rounded ${lang === 'zh' ? 'bg-primary text-primary-foreground' : 'hover:bg-muted'}`}>
          中
        </a>
        <a href={basePath} class={`text-xs px-2 py-1 rounded ${lang === 'en' ? 'bg-primary text-primary-foreground' : 'hover:bg-muted'}`}>
          EN
        </a>
      </div>
      <ThemeToggle />
    </nav>
  </div>
</header>
