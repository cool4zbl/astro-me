---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import BlogCardList from '../../components/BlogCardList.astro';
import { getPageMetadata } from '../../utils/metadata';

const allPosts = await getCollection('blog');
const publishedPosts = allPosts
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.publishedAt.valueOf() - a.data.publishedAt.valueOf());
const { title: pageTitle, description: pageDescription } = getPageMetadata('blog');
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <Header />
  <main class="flex-1">
    <div class="container-width py-16">
      <div class="mx-auto max-w-2xl lg:max-w-4xl">
        <header class="text-center">
          <h1 class="text-3xl font-bold tracking-tight text-foreground sm:text-4xl">
            Blog Posts
          </h1>
          <p class="mt-2 text-lg leading-8 text-muted-foreground">
            {publishedPosts.length} posts in total
          </p>
        </header>

        <BlogCardList posts={publishedPosts} class="mt-8 lg:mt-10" />

        {publishedPosts.length === 0 && (
          <div class="text-center py-16">
            <p class="text-muted-foreground">No posts published yet</p>
          </div>
        )}
      </div>
    </div>
  </main>

  <Footer />
</BaseLayout>
