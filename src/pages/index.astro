---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import BlogCardList from '../components/BlogCardList.astro';
import OptimizedImage from '../components/OptimizedImage.astro';
import { getLangFromUrl, getLocalizedPath, type Language } from '../i18n/config';
import { getHomeCopy } from '../i18n/pages/home';
import { getPageMetadata } from '../utils/metadata';

const lang: Language = Astro.props?.lang ?? getLangFromUrl(Astro.url);
const copy = getHomeCopy(lang);
const { title: pageTitle, description: pageDescription } = getPageMetadata('home');

const allPosts = await getCollection('blog');
const publishedPosts = allPosts
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.publishedAt.valueOf() - a.data.publishedAt.valueOf());
const recentPosts = publishedPosts.slice(0, 3);
const totalPostsLabel = copy.latestPosts.totalLabel(publishedPosts.length);

const heroPrimaryHref = getLocalizedPath(copy.hero.primary.href, lang);
const heroSecondaryHref = getLocalizedPath(copy.hero.secondary.href, lang);
const experienceHref = getLocalizedPath('/experience', lang);
const projectsHref = getLocalizedPath('/projects', lang);
const blogHref = getLocalizedPath('/blog', lang);

const profileImage = '/binliuzhang-avt1.JPG';
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <Header />

  <main class="flex-1">
    <!-- Hero & About Me Section -->
    <section class="section-padding bg-gradient-to-br from-background via-muted/20 to-background">
      <div class="container-width">
        <div class="grid items-center gap-8 lg:grid-cols-2 lg:gap-8 xl:gap-8">
          <div class="animate-fade-in space-y-6">
            <span class="inline-flex items-center gap-2 rounded-full bg-primary/10 px-4 py-2 text-xs font-medium uppercase tracking-[0.25em] text-primary">
              {copy.hero.label}
            </span>
            <h1 class="text-6xl font-extrabold leading-tight text-foreground sm:text-5xl md:text-6xl lg:text-6xl">
              {copy.hero.title}
            </h1>
            <p class="mt-4 max-w-3xl text-slate-300">{copy.hero.subtitle}</p>

            <!--<p class="text-base leading-relaxed text-muted-foreground sm:text-lg">-->
            <!--  {copy.hero.description}-->
            <!--</p>-->

            <div class="space-y-3 text-base leading-relaxed text-muted-foreground sm:text-base">
              {copy.hero.description.map((paragraph) => (
                <p>{paragraph}</p>
              ))}
            </div>

            <div class="flex flex-wrap items-center gap-3">
              <a
                href={heroPrimaryHref}
                class="inline-flex items-center rounded-full bg-primary px-5 py-2.5 text-sm font-semibold text-primary-foreground shadow-sm transition hover:bg-primary/90"
              >
                {copy.hero.primary.label}
              </a>
              <a
                href={heroSecondaryHref}
                class="inline-flex items-center rounded-full border border-primary/30 px-5 py-2.5 text-sm font-semibold text-primary transition hover:bg-primary/10"
              >
                {copy.hero.secondary.label} <span aria-hidden="true" class="ml-2">→</span>
              </a>

              <div class="pointer-events-none absolute inset-0 -z-10 bg-[radial-gradient(ellipse_at_top,rgba(34,211,238,.12),transparent_60%)]"></div>
            </div>
          </div>

          <div class="relative flex justify-center lg:justify-end lg:-ml-8 xl:-ml-12">
            <!-- Decorative accent circles with blurred backgrounds that enhance the page’s visual depth without affecting layout -->
            <div class="absolute -top-8 -right-4 md:block h-28 w-28 rounded-full bg-primary/15 blur-3xl"></div>
            <div class="absolute -bottom-10 -left-6 block h-24 w-24 rounded-full bg-accent/20 blur-3xl lg:block"></div>
            <div class="relative mx-auto h-36 w-36 overflow-hidden rounded-full shadow-2xl md:h-48 md:w-48 lg:h-54 lg:w-54">
              <OptimizedImage
                src={profileImage}
                alt="binliuzhang Professional developer portrait"
                width={500}
                height={500}
                class="h-full w-full object-cover"
                style="width: 100%; height: 100%;"
                loading="lazy"
              />
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Projects Overview Section -->
    <section class="section-padding bg-muted/30">
      <div class="container-width">
        <div class="mb-12 space-y-3 text-center">
          <h2 class="text-3xl font-bold tracking-tight text-foreground sm:text-4xl">
            {copy.projects.title}
          </h2>
          <p class="mx-auto max-w-2xl text-sm leading-relaxed text-muted-foreground sm:text-base">
            {copy.projects.description}
          </p>
        </div>

        <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
          {copy.projects.items.map((project) => (
            <div class="group relative rounded-xl border bg-card p-4 shadow-sm transition-all duration-200 hover:shadow-md">
              <div class="aspect-auto overflow-hidden rounded-lg bg-muted mb-4">
                <OptimizedImage
                  src={project.image.src}
                  alt={project.image.alt}
                  width={1280}
                  height={720}
                  class="h-full w-full object-cover object-center transition-transform duration-200 group-hover:scale-105"
                  loading="lazy"
                />
              </div>
              <h3 class="mb-2 text-xl font-semibold text-card-foreground">
                {project.title}
              </h3>
              <p class="mb-4 text-sm leading-relaxed text-muted-foreground">
                {project.description}
              </p>
              <div class="mb-4 flex flex-wrap gap-2">
                {project.tags.map((tag) => (
                  <span class="inline-flex items-center rounded-full bg-primary/10 px-2 py-1 text-xs font-medium text-primary">{tag}</span>
                ))}
              </div>
            </div>
          ))}
        </div>

        <div class="mt-6 text-center">
          <a
            href={projectsHref}
            class="inline-flex items-center rounded-full border border-secondary px-5 py-2.5 text-sm font-semibold text-secondary-foreground shadow-sm transition hover:bg-secondary"
          >
            {copy.projects.viewAllLabel}
            <svg class="ml-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        </div>
      </div>
    </section>

    <!-- Recent Posts Section -->
    <section class="section-padding">
      <div class="container-width">
        <div class="mb-12 space-y-3 text-center">
          <h2 class="text-3xl font-bold tracking-tight text-foreground sm:text-4xl">{copy.latestPosts.title}</h2>
          <p class="mx-auto max-w-2xl text-sm leading-relaxed text-muted-foreground sm:text-base">
            {copy.latestPosts.description}
          </p>
          <p class="text-xs font-medium uppercase tracking-[0.3em] text-muted-foreground">
            {totalPostsLabel}
          </p>
        </div>
        <BlogCardList posts={recentPosts} lang={lang} />
        <div class="mt-10 text-center">
          <a
            href={blogHref}
            class="inline-flex items-center rounded-full border border-secondary px-5 py-2.5 text-sm font-semibold text-secondary-foreground shadow-sm transition hover:bg-secondary"
          >
            {copy.latestPosts.viewAllLabel}
            <svg class="ml-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        </div>

        {recentPosts.length === 0 && (
          <div class="py-16 text-center">
            <p class="text-muted-foreground">{copy.latestPosts.emptyLabel}</p>
          </div>
        )}
      </div>
    </section>
  </main>

  <Footer />
</BaseLayout>
