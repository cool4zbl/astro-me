---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import OptimizedImage from '../components/OptimizedImage.astro';
import { getLangFromUrl, type Language } from '../i18n/config';

const lang: Language = Astro.props?.lang ?? getLangFromUrl(Astro.url);

const translations = {
  en: {
    hero: {
      prefix: 'My',
      highlight: 'Projects',
      suffix: '',
      description:
        'Case studies from food delivery, mobility, and fintech platforms where I led automation, data, and experimentation initiatives.',
    },
    featured: [
      {
        image: { src: '/placeholder.svg?height=400&width=600', alt: 'Workflow diagram for help experience orchestration' },
        badge: { label: 'Operational Excellence', class: 'bg-primary/10 text-primary' },
        title: 'Help Experience Orchestration Layer',
        subtitle: 'Just Eat Takeaway',
        description:
          'Event-driven automation powering JET’s help chatbot. The orchestration layer coordinates services, state, and playbooks so order issues resolve without manual intervention.',
        sections: [
          {
            title: 'Impact',
            items: [
              'Automated resolution flows for millions of annual customer contacts, reducing manual interventions by 60%.',
              'Improved stability and MTTR with resilient retries, stateful orchestration, and structured observability.',
            ],
          },
          {
            title: 'What I did',
            items: [
              'Owned architecture, API contracts, and rollout strategy across product, operations, and support teams.',
              'Partnered with ops to codify playbooks into reusable workflows, guardrails, and experimentable policies.',
            ],
          },
        ],
        stack: ['Java', 'Spring Boot', 'Kafka', 'AWS SQS', 'Redis'],
        actions: [
          { label: 'Experience Overview', variant: 'outline', href: '/experience' },
        ],
      },
      {
        image: { src: '/placeholder.svg?height=400&width=600', alt: 'Screenshot of JETMS operational console' },
        badge: { label: 'Platform Engineering', class: 'bg-accent/10 text-accent' },
        title: 'JETMS Operational Platform',
        subtitle: 'Just Eat Takeaway',
        description:
          'Multi-tenant workspace that unifies 20+ internal services for customer support agents. CQRS routing, shared data models, and fine-grained permissions keep teams focused on resolution outcomes.',
        sections: [
          {
            title: 'Impact',
            items: [
              'Reduced issue-resolution SLA by ~33% by consolidating fragmented tooling into a single experience.',
              'Enabled market-specific workflows with tenant-aware routing and flexible schema evolution.',
            ],
          },
          {
            title: 'What I did',
            items: [
              'Design service decomposition, and front-end framework-agnostic architecture.',
              'Leverage CQRS patterns and governance for integrating partner teams.',
            ],
          },
        ],
        stack: ['Java', 'TypeScript', 'MySQL', 'CQRS', 'Micro Frontends'],
        actions: [
        // TODO:
          // { label: 'Live Demo', variant: 'primary', href: 'https://jetms.example.com' },
          { label: 'Experience Overview', variant: 'outline', href: '/experience' },
        ],
      },
      {
        image: { src: '/placeholder.svg?height=400&width=600', alt: 'Map and geospatial data pipeline illustration' },
        badge: { label: 'Geo Platforms', class: 'bg-primary/10 text-primary' },
        title: 'Jarvis Crowdsourcing Platform',
        subtitle: 'Grab',
        description:
          'Crowdsourced geospatial data engine fueling Grab’s mobility and delivery products. Coordinates contributor tasks, validates submissions, and feeds downstream routing services.',
        sections: [
          {
            title: 'Impact',
            items: [
              'Scaled to 300K tasks and 400K+ geospatial data points that improved map freshness and trip accuracy.',
              'Cut geospatial storage costs by 70% via data simplification and tiered retention policies.',
            ],
          },
          {
            title: 'What I did',
            items: [
              'Designed task lifecycle, task modeling, and auditing capabilities across data, ops, and product teams.',
              'Implemented high-performance services in Go, PostGIS, and Kafka with proactive monitoring and alerting.',
            ],
          },
        ],
        stack: ['Go', 'PostgreSQL', 'PostGIS', 'Kafka', 'ElasticSearch', 'Redis'],
        actions: [
          { label: 'Experience Overview', variant: 'outline', href: '/experience' },
        ],
      },
    ],
    other: {
      title: 'Other Projects',
      description: 'Additional initiatives that strengthened observability, experimentation, and developer velocity.',
      cards: [
        {
          image: { src: '/placeholder.svg?height=200&width=350', alt: 'Streaming logs visualization' },
          title: 'Centralized Logging Pipeline',
          description: 'Benthos + Kafka + AWS SQS pipeline processing 50K+ logs/day into OpenSearch, cutting MTTR by 25% and unlocking proactive alerting.',
          tags: ['Benthos', 'Kafka', 'AWS SQS', 'OpenSearch'],
        },
        {
          image: { src: '/placeholder.svg?height=200&width=350', alt: 'Experiment dashboard mockup' },
          title: 'Darwin Experimentation Platform',
          description: 'Re-architected experimentation APIs and SDKs at Ant Group to support 1,000+ annual experiments and drive a 2% conversion lift.',
          tags: ['Java', 'SDK', 'Experimentation'],
        },
        // TODO:
        {
          image: { src: '/placeholder.svg?height=200&width=350', alt: 'Street-view map tiles' },
          title: 'KartaView Street-View Service',
          description: 'High-performance PostGIS service applying the Douglas–Peucker algorithm to shrink geospatial datasets by 70% for faster queries.',
          tags: ['Go', 'PostGIS', 'Microservices'],
        },
      ],
    },
  },
} as const;

const copy = translations[lang] ?? translations.en;

const actionClassMap = {
  primary:
    'inline-flex items-center rounded-md bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground shadow-sm transition-colors hover:bg-primary/90',
  outline:
    'inline-flex items-center rounded-md border border-input bg-background px-4 py-2 text-sm font-semibold text-foreground shadow-sm transition-colors hover:bg-accent hover:text-accent-foreground',
} as const;
---

<BaseLayout
  title="Projects - My Portfolio"
  description="Explore my full-stack development projects featuring Java backend systems, modern web applications, and cloud-native solutions."
>
  <Header />

  <main class="flex-1">
    <!-- Hero Section -->
    <section class="section-padding bg-gradient-to-br from-background via-muted/20 to-background">
      <div class="container-width text-center">
        <h1 class="text-4xl font-bold tracking-tight text-foreground sm:text-5xl lg:text-6xl mb-6">
          {copy.hero.prefix}
          {copy.hero.prefix ? ' ' : ''}
          <span class="gradient-text">{copy.hero.highlight}</span>
          {copy.hero.suffix ? ` ${copy.hero.suffix}` : ''}
        </h1>
        <p class="mx-auto max-w-2xl text-lg leading-8 text-muted-foreground sm:text-xl">
          {copy.hero.description}
        </p>
      </div>
    </section>

    <!-- Featured Projects -->
    <section class="section-padding">
      <div class="container-width">
        <div class="space-y-24">
          {copy.featured.map((project, index) => (
            <div class="grid gap-12 items-center lg:grid-cols-2 lg:gap-16">
              <div class={index % 2 === 0 ? 'order-2 lg:order-1' : 'order-2 lg:order-1'}>
                <div class={`inline-flex items-center rounded-full px-3 py-1 text-sm font-medium mb-4 ${project.badge.class}`}>
                  {project.badge.label}
                </div>
                <h2 class="text-3xl font-bold tracking-tight text-foreground sm:text-4xl mb-4">
                  {project.title}
                </h2>
                <p class="text-lg text-muted-foreground mb-6 leading-relaxed">
                  {project.description}
                </p>
                <div class="space-y-4 mb-6">
                  {project.sections.map((section) => (
                    <div>
                      <h3 class="font-semibold text-foreground mb-2">{section.title}:</h3>
                      <ul class="text-muted-foreground space-y-1 text-sm">
                        {section.items.map((item) => (
                          <li>• {item}</li>
                        ))}
                      </ul>
                    </div>
                  ))}
                </div>
                <div class="flex flex-wrap gap-2 mb-6">
                  {project.stack.map((tech) => (
                    <span class="inline-flex items-center rounded-full bg-primary/10 px-3 py-1 text-sm font-medium text-primary">{tech}</span>
                  ))}
                </div>
                {project.actions && project.actions.length > 0 && (
                  <div class="flex gap-4 flex-wrap">
                    {project.actions.map((action) => (
                      <a href={action.href ?? '#'} class={actionClassMap[action.variant]}>
                        {action.label}
                      </a>
                    ))}
                  </div>
                )}
              </div>
              <div class={index % 2 === 0 ? 'order-1 lg:order-2' : 'order-1 lg:order-2'}>
                <div class="aspect-video rounded-xl bg-muted overflow-hidden shadow-2xl">
                  <OptimizedImage
                    src={project.image.src}
                    alt={project.image.alt}
                    width={600}
                    height={400}
                    class="h-full w-full object-cover"
                    loading="lazy"
                  />
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- Other Projects Grid -->
    <section class="section-padding bg-muted/30">
      <div class="container-width">
        <div class="text-center mb-16">
          <h2 class="text-3xl font-bold tracking-tight text-foreground sm:text-4xl mb-4">
            {copy.other.title}
          </h2>
          <p class="text-lg text-muted-foreground max-w-2xl mx-auto">
            {copy.other.description}
          </p>
        </div>

        <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
          {copy.other.cards.map((card) => (
            <div class="rounded-xl border bg-card p-6 shadow-sm transition-all duration-200 hover:shadow-md">
              <div class="aspect-video rounded-lg bg-muted mb-4 overflow-hidden">
                <OptimizedImage
                  src={card.image.src}
                  alt={card.image.alt}
                  width={350}
                  height={200}
                  class="h-full w-full object-cover"
                  loading="lazy"
                />
              </div>
              <h3 class="text-xl font-semibold text-card-foreground mb-2">{card.title}</h3>
              <p class="text-muted-foreground text-sm mb-4">
                {card.description}
              </p>
              <div class="flex flex-wrap gap-2 mb-4">
                {card.tags.map((tag) => (
                  <span class="inline-flex items-center rounded-full bg-secondary px-2 py-1 text-xs font-medium text-secondary-foreground">{tag}</span>
                ))}
              </div>
              <a href="#" class="text-primary hover:text-accent font-medium text-sm transition-colors">
                {lang === 'zh' ? '查看项目 →' : 'View Project →'}
              </a>
            </div>
          ))}
        </div>
      </div>
    </section>
  </main>

  <Footer />
</BaseLayout>
